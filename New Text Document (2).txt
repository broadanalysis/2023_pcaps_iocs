
Parent Process: For most wsmprovhost
TIME: Sep. 24, 2024 03:53:47
CMD: ping REDACTED IP
TIME: Sep. 24, 2024 04:02:57
CMD: ping -a REDACTED IP
CMD: ping REDACTED HOST
TIME: Sep. 24, 2024 04:22:44
CMD: quser /server:REDACTED IP
CMD: quser /server:veeam
CMD: ping -a veeam
CMD: Get-Service -ComputerName veeam
TIME: Sep. 24, 2024 04:32:42
CMD: whoami
CMD: quser /server:REDACTED IP
CMD: net user REDACTED_admin /domain
TIME: Sep. 24, 2024 04:57:51
CMD: quser /server:REDACTED IP
TIME: Sep. 24, 2024 05:05:08
CMD: mstsc /v REDACTED IP
TIME: Sep. 24, 2024 05:10:19
CMD: ping REDACTED IP
CMD: ping -a REDACTED IP
TIME: Sep. 24, 2024 06:19:46
CMD: net user svc_vfax /domain
CMD: net user svc_vbackup /domain
TIME: Sep. 24, 2024 06:33:55
CMD: whoami
TIME: Sep. 24, 2024 07:08:06
CMD: regedit
TIME: Sep. 24, 2024 07:21:06
CMD: ise
TIME: Sep. 24, 2024 07:21:12
CMD: @(Get-Command -CommandType Cmdlet, Function, Script, ExternalScript, Workflow),@(get-module)
CMD: Enter-PSSession REDACTED HOST
TIME: Sep. 24, 2024 07:39:25
CMD: filter more { $_ }
CMD:
function psEdit([Parameter(Mandatory=$true)]$filenames)
{
    foreach ($filename in $filenames)
    {
        dir $filename | where {!$_.PSIsContainer} | %{
            $psISE.CurrentPowerShellTab.Files.Add($_.FullName) > $null
        }
    }
}
CMD: $OutputEncoding = [System.Console]::OutputEncoding
CMD: ipmo ISE
CMD: Enter-PSSession REDACTED HOST
TIME: Sep. 24, 2024 07:44:25
CMD: ise
TIME: Sep. 24, 2024 07:44:40
CMD: Enter-PSSession REDACTED HOST
{code}

PowerShell Commands ran on 9/23/2024:
[Microsoft.Windows.PowerShell.Gui.Internal.HostTextWriter]::RegisterHost($host.ui)
filter more { $_ }
function psEdit([Parameter(Mandatory=$true)]$filenames)
{
    foreach ($filename in $filenames)
    {
        dir $filename | where {!$_.PSIsContainer} | %{
            $psISE.CurrentPowerShellTab.Files.Add($_.FullName) > $null
        }
    }
}
$OutputEncoding = [System.Console]::OutputEncoding
ipmo ISE
prompt
@(Get-Command  -CommandType Cmdlet, Function, Script, ExternalScript, Workflow),@(get-module)
netstat -ano
prompt
ping REDACTED IP
prompt
ping -a REDACTED IP
prompt
ping -a REDACTED IP
prompt
quser /server:REDACTED HOST NAME
{ Set-StrictMode -Version 1; $_.PSMessageDetails }
{ Set-StrictMode -Version 1; $this.Exception.InnerException.PSMessageDetails }
{ Set-StrictMode -Version 1; $_.ErrorCategory_Message }
{ Set-StrictMode -Version 1; $_.OriginInfo }
prompt
quser /server:REDACTED IP
{ Set-StrictMode -Version 1; $_.PSMessageDetails }
{ Set-StrictMode -Version 1; $_.ErrorCategory_Message }
{ Set-StrictMode -Version 1; $_.OriginInfo }
prompt
[Microsoft.Windows.PowerShell.Gui.Internal.HostTextWriter]::RegisterHost($host.ui)
filter more { $_ }
function psEdit([Parameter(Mandatory=$true)]$filenames)
{
    foreach ($filename in $filenames)
    {
        dir $filename | where {!$_.PSIsContainer} | %{
            $psISE.CurrentPowerShellTab.Files.Add($_.FullName) > $null
        }
    }
}
$OutputEncoding = [System.Console]::OutputEncoding
ipmo ISE
prompt
Enter-PSSession REDACTED HOST NAME
quser /server:REDACTED IP
{ Set-StrictMode -Version 1; $_.PSMessageDetails }
{ Set-StrictMode -Version 1; $_.ErrorCategory_Message }
{ Set-StrictMode -Version 1; $_.OriginInfo }
prompt
quser /server:REDACTED HOST NAME
{ Set-StrictMode -Version 1; $_.PSMessageDetails }
{ Set-StrictMode -Version 1; $_.ErrorCategory_Message }
{ Set-StrictMode -Version 1; $_.OriginInfo }
prompt
[Microsoft.Windows.PowerShell.Gui.Internal.HostTextWriter]::RegisterHost($host.ui)
filter more { $_ }
function psEdit([Parameter(Mandatory=$true)]$filenames)
{
    foreach ($filename in $filenames)
    {
        dir $filename | where {!$_.PSIsContainer} | %{
            $psISE.CurrentPowerShellTab.Files.Add($_.FullName) > $null
        }
    }
}
$OutputEncoding = [System.Console]::OutputEncoding
ipmo ISE
prompt
Enter-PSSession REDACTED HOST NAME
{ Set-StrictMode -Version 1; $_.PSMessageDetails }
{ Set-StrictMode -Version 1; $this.Exception.InnerException.PSMessageDetails }
{ Set-StrictMode -Version 1; $_.ErrorCategory_Message }
{ Set-StrictMode -Version 1; $_.OriginInfo }
prompt
ping -a REDACTED IP
prompt
Enter-PSSession REDACTED HOST NAME
{ Set-StrictMode -Version 1; $_.PSMessageDetails }
{ Set-StrictMode -Version 1; $_.ErrorCategory_Message }
{ Set-StrictMode -Version 1; $_.OriginInfo }
prompt
New-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Lsa" -Name "DisableRestrictedAdmin" -Value "0" -PropertyType DWORD -Force
prompt
quser
prompt
quser
ping -a REDACTED IP
prompt
quser
prompt
cmd /c Del /F /Q %APPDATA%\Microsoft\Windows\Recent\*
cmd /c Del /F /Q %APPDATA%\Microsoft\Windows\Recent\AutomaticDestinations\*
cmd /c Del /F /Q %APPDATA%\Microsoft\Windows\Recent\CustomDestinations\*
Get-ChildItem "HKCU:\Software\Microsoft\Terminal Server Client" -Recurse | Remove-ItemProperty -Name UsernameHint -Ea 0
Remove-Item -Path 'HKCU:\Software\Microsoft\Terminal Server Client\servers' -Recurse  2>&1 | Out-Null
Remove-ItemProperty -Path 'HKCU:\Software\Microsoft\Terminal Server Client\Default' 'MR*'  2>&1 | Out-Null
$docs = [Environment]::GetFolderPath('MyDocuments') + '\Default.rdp'
Remove-Item  $docs  -Force  2>&1 | Out-Null
Remove-Item -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU -Recurse
Remove-Item (Get-PSReadlineOption).HistorySavePath
Remove-Item -Path $env:TEMP\* -Recurse -force -ErrorAction SilentlyContinue
Remove-Item C:\Users\$env:UserName\AppData\Local\Temp -Recurse -force -ErrorAction SilentlyContinue
Remove-Item $env:USERPROFILE\AppData\Local\Temp -Recurse -force -ErrorAction SilentlyContinue
Remove-Item C:\Windows\Temp -Recurse -force -ErrorAction SilentlyContinue
Remove-Item C:\Users\$env:UserName\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
{ Set-StrictMode -Version 1; $_.PSMessageDetails }
{ Set-StrictMode -Version 1; $_.ErrorCategory_Message }
{ Set-StrictMode -Version 1; $_.OriginInfo }
{ Set-StrictMode -Version 1; $_.PSMessageDetails }
{ Set-StrictMode -Version 1; $_.ErrorCategory_Message }
{ Set-StrictMode -Version 1; $_.OriginInfo }
prompt
Clear-History
prompt
logoff
prompt

autoservice.dll is suspect Sliver C2:
C:\Windows\system32\svchost.exe -k netsvcs
"C:\Windows\system32\mmc.exe" "C:\Windows\system32\taskschd.msc" /s
"C:\Windows\System32\rundll32.exe" C:\temp\autoservice.dll rundll

1a70f4eef11fbecb721b9bab1c9ff43a8c4cd7b2cafef08c033c77070c6fe069 - Anydesk
1845a910dcde8c6e45ad2e0c48439e5ab8bbbeb731f2af11a167bbab3bfe0127 - Implant
4069aa29628e64ea63b4fb3e29d16dcc368c5add304358a47097eedafbbb565 - Implant

https://github.com/Leo4j/Invoke-SMBRemoting

